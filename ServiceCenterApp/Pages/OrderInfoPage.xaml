<Page x:Class="ServiceCenterApp.Pages.OrderInfoPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:ServiceCenterApp.Pages"
      xmlns:controls="clr-namespace:ServiceCenterApp.Controls"
      mc:Ignorable="d" 
      d:DesignHeight="900" d:DesignWidth="1400"
      Title="OrderInfoPage">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0" Margin="0,0,0,20">
                <TextBlock FontSize="28" FontWeight="Bold" Foreground="{StaticResource DarkBackgroundBrush}" VerticalAlignment="Center">
                    <Run Text="Заявка №"/>
                    <Run Text="{Binding Order.OrderId}"/>
                </TextBlock>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Назад" Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,10,0" Width="100"/>
                    <Button Content="Сохранить изменения" Style="{StaticResource AccentButtonStyle}"/>
                </StackPanel>
            </DockPanel>

            <!-- Основная панель с 3 колонками -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.2*"/>
                    <!-- Левая колонка (Клиент) -->
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="2*"/>
                    <!-- Центральная колонка (Главное) -->
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="1.2*"/>
                    <!-- Правая колонка (Устройство) -->
                </Grid.ColumnDefinitions>

                <!-- ЦЕНТРАЛЬНАЯ КОЛОНКА (САМОЕ ВАЖНОЕ) -->
                <StackPanel Grid.Column="2">
                    <TextBlock Text="КЛЮЧЕВАЯ ИНФОРМАЦИЯ" Style="{StaticResource SectionHeaderStyle}"/>
                    <Border Style="{StaticResource InfoBorderStyle}">
                        <StackPanel>
                            <DockPanel>
                                <TextBlock Text="Статус заказа:" FontSize="14" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10 6" Width="160"/>
                                <ComboBox Grid.Row="0" Grid.Column="1" 
                                  ItemsSource="{Binding AllOrderStatuses}" 
                                  SelectedItem="{Binding SelectedOrderStatus}"
                                  Style="{StaticResource PageComboBoxStyle}"
                                  ItemContainerStyle="{StaticResource ColorStatusComboBoxItemContainerStyle}"
                                  ItemTemplate="{StaticResource ColorStatusComboBoxItemTemplate}"
                                  FontSize="14" Margin="0 0 0 5"/>
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Text="Назначенный мастер:" FontSize="14" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Width="160" Margin="0,0,10 6"/>
                                <ComboBox Grid.Row="1" Grid.Column="1" Style="{StaticResource PageComboBoxStyle}" ItemsSource="{Binding AllEmployees}" SelectedItem="{Binding SelectedEmployee}" 
                                      ItemTemplate="{StaticResource EmployeeComboBoxItemTemplate}"
                                      FontSize="14" Margin="0,0,0,5"/>
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Text="Приоритет:" Grid.Row="2" FontSize="14" Grid.Column="0" VerticalAlignment="Center" Width="160" Margin="0,0,10 6"/>
                                <ComboBox Grid.Row="2" Grid.Column="1" Style="{StaticResource PageComboBoxStyle}" ItemsSource="{Binding AllPriorities}" SelectedItem="{Binding SelectedPriority}"
                                      ItemTemplate="{StaticResource PriorityComboBoxItemTemplate}" FontSize="14" Margin="0,0,0,5"/>
                            </DockPanel>
                            <Separator Margin="0 10 0 10"/>

                            <DockPanel>
                                <TextBlock Text="Создатель:" Grid.Row="3" FontSize="14" Grid.Column="0" VerticalAlignment="Center" Width="160" Margin="0,0,10 6"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" VerticalAlignment="Center" FontSize="14" Margin="0,0,10 6">
                                <Run Text="{Binding Order.CreatorEmployee.SurName}"/>
                                <Run Text="{Binding Order.CreatorEmployee.FirstName}"/>
                                </TextBlock>
                            </DockPanel>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="ИСПОЛЬЗУЕМЫЕ ЗАПЧАСТИ" Style="{StaticResource SectionHeaderStyle}"/>
                    <Border Style="{StaticResource InfoBorderStyle}">
                        <StackPanel>
                            <DataGrid ItemsSource="{Binding UsedSpareParts}" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Название" Binding="{Binding SparePart.Name}" Width="*"/>
                                    <DataGridTextColumn Header="Артикул" Binding="{Binding SparePart.PartNumber}" Width="Auto"/>
                                    <DataGridTextColumn Header="Кол-во" Binding="{Binding Quantity}" Width="Auto"/>
                                    <DataGridTextColumn Header="Цена" Binding="{Binding SparePart.Price, StringFormat={}{0:C0}}" Width="Auto"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Content="+ Добавить запчасть" Style="{StaticResource SecondaryButtonStyle}" HorizontalAlignment="Right" Margin="0,10,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- ЛЕВАЯ КОЛОНКА (КЛИЕНТ) -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="ИНФОРМАЦИЯ О КЛИЕНТЕ" Style="{StaticResource SectionHeaderStyle}"/>
                    <Border Style="{StaticResource InfoBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="Фамилия"/>
                            <TextBox Text="{Binding Order.Client.SurName}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Имя"/>
                            <TextBox Text="{Binding Order.Client.FirstName}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Отчество"/>
                            <TextBox Text="{Binding Order.Client.Patronymic}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Телефон"/>
                            <TextBox Text="{Binding Order.Client.PhoneNumber}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Email"/>
                            <TextBox Text="{Binding Order.Client.Email}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Комментарий клиента"/>
                            <TextBox Text="{Binding Order.Client.Comment}" TextWrapping="Wrap" MinHeight="60" Style="{StaticResource EditableTextBoxStyle}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- ПРАВАЯ КОЛОНКА (УСТРОЙСТВО И ДЕТАЛИ) -->
                <StackPanel Grid.Column="4">
                    <TextBlock Text="ИНФОРМАЦИЯ ОБ УСТРОЙСТВЕ" Style="{StaticResource SectionHeaderStyle}"/>
                    <Border Style="{StaticResource InfoBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="Тип устройства"/>
                            <TextBox Text="{Binding Order.Device.DeviceType}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Бренд"/>
                            <TextBox Text="{Binding Order.Device.Brand}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Модель"/>
                            <TextBox Text="{Binding Order.Device.Model}" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Серийный номер"/>
                            <TextBox Text="{Binding Order.Device.SerialNumber}" Style="{StaticResource EditableTextBoxStyle}"/>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="ДЕТАЛИ ЗАКАЗА" Style="{StaticResource SectionHeaderStyle}"/>
                    <Border Style="{StaticResource InfoBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="Описание неисправности"/>
                            <TextBox Text="{Binding Order.ProblemDescription}" TextWrapping="Wrap" MinHeight="80" Style="{StaticResource EditableTextBoxStyle}"/>
                            <TextBlock Text="Дополнительный комментарий"/>
                            <TextBox Text="{Binding Order.Comment}" TextWrapping="Wrap" MinHeight="60" Style="{StaticResource EditableTextBoxStyle}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>